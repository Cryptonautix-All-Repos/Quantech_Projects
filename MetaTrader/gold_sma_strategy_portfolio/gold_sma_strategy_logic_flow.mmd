flowchart TD
    A[ğŸ“Š Start: New Tick Received] --> B{ğŸ“ˆ Sufficient Historical Data?<br/>Long SMA + 5 bars}
    B -->|No| Z[âŒ Exit - Wait for Data]
    B -->|Yes| C[ğŸ“Š Get Current & Previous<br/>SMA Values]
    
    C --> D{ğŸ”„ SMA Crossover Detected?}
    D -->|No Crossover| A
    D -->|Bullish Cross<br/>Short > Long| E[ğŸ“ˆ Bullish Signal Detected]
    D -->|Bearish Cross<br/>Short < Long| F[ğŸ“‰ Bearish Signal Detected]
    
    E --> G{ğŸ“Š Current Candle<br/>Forming Bullish?<br/>Price > Open}
    F --> H{ğŸ“Š Current Candle<br/>Forming Bearish?<br/>Price < Open}
    
    G -->|No| I[âŒ Signal Cancelled]
    H -->|No| I
    G -->|Yes| J{ğŸ“ Candle Body Size<br/>â‰¥ 30 Pips?}
    H -->|Yes| K{ğŸ“ Candle Body Size<br/>â‰¥ 30 Pips?}
    
    J -->|No| I
    K -->|No| I
    J -->|Yes| L{ğŸ“ Total Candle Size<br/>â‰¥ Min Size Filter?}
    K -->|Yes| M{ğŸ“ Total Candle Size<br/>â‰¥ Min Size Filter?}
    
    L -->|No| I
    M -->|No| I
    L -->|Yes| N{âš™ï¸ Trade Filter<br/>Allows Buy?}
    M -->|Yes| O{âš™ï¸ Trade Filter<br/>Allows Sell?}
    
    N -->|No| I
    O -->|No| I
    N -->|Yes| P[âœ… BUY Signal Active<br/>Store Signal Candle]
    O -->|Yes| Q[âœ… SELL Signal Active<br/>Store Signal Candle]
    
    P --> R[ğŸ¯ Monitor for Buy Entry]
    Q --> S[ğŸ¯ Monitor for Sell Entry]
    
    R --> T{ğŸ’° Price Breaks<br/>Signal Candle High?}
    S --> U{ğŸ’° Price Breaks<br/>Signal Candle Low?}
    
    T -->|No| V{ğŸ“‰ Price Below<br/>Signal Candle Low?}
    U -->|No| W{ğŸ“ˆ Price Above<br/>Signal Candle High?}
    
    V -->|Yes| X[âŒ Buy Signal Cancelled]
    W -->|Yes| Y[âŒ Sell Signal Cancelled]
    V -->|No| T
    W -->|No| U
    
    T -->|Yes| AA{ğŸ¯ MA Touch Filter<br/>Enabled?}
    U -->|Yes| BB{ğŸ¯ MA Touch Filter<br/>Enabled?}
    
    AA -->|No| CC[ğŸ”¥ Execute BUY Trade]
    BB -->|No| DD[ğŸ”¥ Execute SELL Trade]
    AA -->|Yes| EE{ğŸ“Š Entry Price Too Close<br/>to MA Lines?}
    BB -->|Yes| FF{ğŸ“Š Entry Price Too Close<br/>to MA Lines?}
    
    EE -->|Yes| GG[âŒ Buy Entry Rejected<br/>MA Touch Filter]
    FF -->|Yes| HH[âŒ Sell Entry Rejected<br/>MA Touch Filter]
    EE -->|No| CC
    FF -->|No| DD
    
    CC --> II[âš™ï¸ Calculate Position Size<br/>Risk % or Fixed Lot]
    DD --> JJ[âš™ï¸ Calculate Position Size<br/>Risk % or Fixed Lot]
    
    II --> KK[ğŸ¯ Set Stop Loss<br/>Signal Candle Low]
    JJ --> LL[ğŸ¯ Set Stop Loss<br/>Signal Candle High + Spread]
    
    KK --> MM[ğŸ¯ Set Take Profit<br/>1:1 Risk Reward]
    LL --> NN[ğŸ¯ Set Take Profit<br/>1:1 Risk Reward]
    
    MM --> OO[ğŸ“ Submit BUY Order]
    NN --> PP[ğŸ“ Submit SELL Order]
    
    OO --> QQ{âœ… Order Executed<br/>Successfully?}
    PP --> RR{âœ… Order Executed<br/>Successfully?}
    
    QQ -->|Yes| SS[ğŸ¯ Position Management<br/>Start Monitoring]
    RR -->|Yes| SS
    QQ -->|No| TT[âŒ Order Failed]
    RR -->|No| TT
    
    SS --> UU{ğŸ“Š Trailing Stops<br/>Enabled?}
    UU -->|No| VV[ğŸ”„ Continue Monitoring]
    UU -->|Yes| WW{ğŸ“ˆ Current P&L<br/>â‰¥ 0.8 Risk Reward?}
    
    WW -->|No| VV
    WW -->|Yes| XX[ğŸ¯ Activate Trailing Stop<br/>Move SL to 0.5 RR]
    
    XX --> YY[ğŸ”„ Continue Trail Management]
    
    VV --> ZZ[ğŸ”„ Return to Tick Monitoring]
    YY --> ZZ
    TT --> ZZ
    I --> A
    X --> A
    Y --> A
    GG --> A
    HH --> A
    ZZ --> A
    Z --> A
    
    classDef startEnd fill:#ffd700,stroke:#000,stroke-width:2px,color:#000
    classDef process fill:#1a1f2e,stroke:#ffd700,stroke-width:2px,color:#e1e6ed
    classDef decision fill:#242938,stroke:#3742fa,stroke-width:2px,color:#e1e6ed
    classDef success fill:#00ff88,stroke:#000,stroke-width:2px,color:#000
    classDef error fill:#ff4757,stroke:#000,stroke-width:2px,color:#fff
    classDef signal fill:#3742fa,stroke:#ffd700,stroke-width:2px,color:#fff
    
    class A,Z,ZZ startEnd
    class C,II,JJ,KK,LL,MM,NN,OO,PP,SS,XX,YY,VV process
    class B,D,G,H,J,K,L,M,N,O,T,U,V,W,AA,BB,EE,FF,QQ,RR,UU,WW decision
    class P,Q,CC,DD success
    class I,X,Y,GG,HH,TT error
    class E,F signal